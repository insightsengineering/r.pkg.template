---
name: gitleaks ðŸ’§

on:
  push:
    branches:
      - main
      - pre-release
  pull_request:
    branches:
      - main
      - pre-release
  workflow_call:
    inputs:
      additional_args:
        description: Additional arguments to pass to gitleaks
        required: false
        type: string
        default: ""

jobs:
  gitleaks:
    name: gitleaks ðŸ’§
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo ðŸ›Ž
        uses: actions/checkout@v2

      - name: Download and install gitleaks
        run: |
          GITLEAKS_VERSION=$(curl -s https://api.github.com/repos/zricethezav/gitleaks/releases/latest | jq -r '.tag_name')
          sudo wget -q \
            "https://github.com/zricethezav/gitleaks/releases/download/${GITLEAKS_VERSION}/gitleaks-linux-amd64" \
            -O /usr/bin/gitleaks || echo "Error downloading gitleaks ${GITLEAKS_VERSION}"
          sudo chmod +x /usr/bin/gitleaks || echo "Error adding execute permissions to gitleaks"
        shell: bash

      - name: Run gitleaks â˜”
        run: gitleaks -v --no-git ${{ inputs.additional_args }} --path .
        shell: bash
